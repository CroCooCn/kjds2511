<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完整 API 測試工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',
                'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
        }
        
        .section h2 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            height: 40px;
            padding: 0 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        input:focus, select:focus {
            border-color: #e93323;
            outline: none;
        }
        
        .code-group {
            display: flex;
            gap: 10px;
        }
        
        .code-group input {
            flex: 1;
        }
        
        .code-group button {
            width: 120px;
            height: 40px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button {
            height: 40px;
            padding: 0 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        
        button.primary {
            background: #e93323;
            color: #fff;
        }
        
        button.primary:hover {
            background: #d6281a;
        }
        
        button.secondary {
            background: #6c757d;
            color: #fff;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result.success {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            color: #0369a1;
        }
        
        .result.error {
            background: #fef2f2;
            border: 1px solid #ef4444;
            color: #dc2626;
        }
        
        .token-display {
            margin-top: 10px;
            padding: 10px;
            background: #f9fafb;
            border-radius: 4px;
            word-break: break-all;
            font-size: 11px;
        }
        
        .api-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .api-item {
            padding: 15px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .api-item:hover {
            border-color: #e93323;
            box-shadow: 0 2px 8px rgba(233, 51, 35, 0.1);
        }
        
        .api-item h3 {
            font-size: 14px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .api-item .method {
            display: inline-block;
            padding: 2px 8px;
            background: #e93323;
            color: #fff;
            border-radius: 3px;
            font-size: 11px;
            margin-right: 5px;
        }
        
        .api-item .url {
            font-size: 12px;
            color: #666;
            word-break: break-all;
        }
        
        .info {
            padding: 15px;
            background: #fff7ed;
            border: 1px solid #fb923c;
            border-radius: 4px;
            font-size: 14px;
            color: #9a3412;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>完整 API 測試工具</h1>
        
        <div class="info">
            <strong>使用說明：</strong><br>
            1. 首先使用驗證碼登錄獲取 Token（推薦，無需密碼）<br>
            2. 登錄成功後，Token 會自動保存<br>
            3. 點擊下方的 API 接口進行測試<br>
            4. 所有需要認證的接口會自動使用保存的 Token
        </div>
        
        <!-- 登錄區域 -->
        <div class="section">
            <h2>步驟 1：登錄獲取 Token</h2>
            
            <div class="form-group">
                <label>API 地址</label>
                <input type="text" id="apiUrl" value="http://localhost:8080/api/front" placeholder="後端 API 地址">
            </div>
            
            <div class="form-group">
                <label>手機號</label>
                <input type="text" id="phone" value="18292417675" placeholder="請輸入手機號">
            </div>
            
            <div class="form-group">
                <label>驗證碼</label>
                <div class="code-group">
                    <input type="text" id="captcha" placeholder="請輸入6位驗證碼" maxlength="6">
                    <button onclick="sendCode()" id="sendCodeBtn">發送驗證碼</button>
                </div>
            </div>
            
            <button class="primary" onclick="login()" style="width: 100%;">驗證碼登錄</button>
            
            <div id="loginResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Token 顯示 -->
        <div class="section" id="tokenSection" style="display: none;">
            <h2>當前 Token</h2>
            <div class="token-display" id="tokenDisplay"></div>
            <button class="secondary" onclick="clearToken()" style="margin-top: 10px;">清除 Token</button>
        </div>
        
        <!-- API 測試區域 -->
        <div class="section" id="apiSection" style="display: none;">
            <h2>步驟 2：測試 API 接口</h2>
            
            <div class="api-list">
                <div class="api-item" onclick="testApi('GET', '/user', '獲取用戶信息')">
                    <h3><span class="method">GET</span>獲取用戶信息</h3>
                    <div class="url">/user</div>
                </div>
                
                <div class="api-item" onclick="testApi('GET', '/product/good?page=1&limit=10', '商品列表')">
                    <h3><span class="method">GET</span>商品列表</h3>
                    <div class="url">/product/good</div>
                </div>
                
                <div class="api-item" onclick="testApi('GET', '/cart/list', '購物車列表')">
                    <h3><span class="method">GET</span>購物車列表</h3>
                    <div class="url">/cart/list</div>
                </div>
                
                <div class="api-item" onclick="testApi('GET', '/order/list?page=1&limit=10', '訂單列表')">
                    <h3><span class="method">GET</span>訂單列表</h3>
                    <div class="url">/order/list</div>
                </div>
                
                <div class="api-item" onclick="testApi('GET', '/index', '首頁數據')">
                    <h3><span class="method">GET</span>首頁數據</h3>
                    <div class="url">/index</div>
                </div>
                
                <div class="api-item" onclick="testApi('GET', '/category', '分類列表')">
                    <h3><span class="method">GET</span>分類列表</h3>
                    <div class="url">/category</div>
                </div>
            </div>
            
            <div id="apiResult" class="result" style="display: none; margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        let countdown = null;
        
        // 檢查是否有保存的 Token
        window.onload = function() {
            const token = localStorage.getItem('LOGIN_STATUS');
            if (token) {
                showToken(token);
            }
        };
        
        async function sendCode() {
            const apiUrl = document.getElementById('apiUrl').value;
            const phone = document.getElementById('phone').value;
            const btn = document.getElementById('sendCodeBtn');
            
            if (!phone || !/^1[3-9]\d{9}$/.test(phone)) {
                showLoginResult('請輸入正確的手機號', 'error');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = '發送中...';
            
            try {
                const response = await fetch(`${apiUrl}/sendCode?phone=${phone}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    showLoginResult('驗證碼發送成功！請查看 Redis 或後端日誌', 'success');
                    startCountdown();
                } else {
                    showLoginResult('驗證碼發送失敗：' + (result.message || '未知錯誤'), 'error');
                    btn.disabled = false;
                    btn.textContent = '發送驗證碼';
                }
            } catch (error) {
                showLoginResult('請求失敗：' + error.message, 'error');
                btn.disabled = false;
                btn.textContent = '發送驗證碼';
            }
        }
        
        function startCountdown() {
            const btn = document.getElementById('sendCodeBtn');
            let time = 60;
            
            if (countdown) clearInterval(countdown);
            
            countdown = setInterval(() => {
                time--;
                btn.textContent = `${time}秒後重發`;
                
                if (time <= 0) {
                    clearInterval(countdown);
                    btn.disabled = false;
                    btn.textContent = '發送驗證碼';
                }
            }, 1000);
        }
        
        async function login() {
            const apiUrl = document.getElementById('apiUrl').value;
            const phone = document.getElementById('phone').value;
            const captcha = document.getElementById('captcha').value;
            
            if (!phone || !/^1[3-9]\d{9}$/.test(phone)) {
                showLoginResult('請輸入正確的手機號', 'error');
                return;
            }
            
            if (!captcha || !/^\d{6}$/.test(captcha)) {
                showLoginResult('請輸入6位數字驗證碼', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${apiUrl}/login/mobile`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        phone: phone,
                        captcha: captcha,
                        spread_spid: 0
                    })
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    // 保存 token
                    localStorage.setItem('LOGIN_STATUS', result.data.token);
                    if (result.data.uid) {
                        localStorage.setItem('UID', result.data.uid);
                    }
                    
                    showLoginResult('登錄成功！Token 已保存', 'success', result.data.token);
                    showToken(result.data.token);
                } else {
                    showLoginResult('登錄失敗：' + (result.message || '未知錯誤'), 'error');
                }
            } catch (error) {
                showLoginResult('請求失敗：' + error.message, 'error');
            }
        }
        
        function showToken(token) {
            document.getElementById('tokenSection').style.display = 'block';
            document.getElementById('apiSection').style.display = 'block';
            document.getElementById('tokenDisplay').textContent = token;
        }
        
        function clearToken() {
            localStorage.removeItem('LOGIN_STATUS');
            localStorage.removeItem('UID');
            document.getElementById('tokenSection').style.display = 'none';
            document.getElementById('apiSection').style.display = 'none';
            showLoginResult('Token 已清除', 'success');
        }
        
        function showLoginResult(message, type, token) {
            const resultDiv = document.getElementById('loginResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result ' + type;
            
            let html = message;
            if (token) {
                html += '\n\nToken: ' + token;
            }
            resultDiv.textContent = html;
        }
        
        async function testApi(method, url, name) {
            const apiUrl = document.getElementById('apiUrl').value;
            const token = localStorage.getItem('LOGIN_STATUS');
            const resultDiv = document.getElementById('apiResult');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = `正在測試 ${name}...`;
            
            try {
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authori-zation'] = token;
                }
                
                const response = await fetch(apiUrl + url, {
                    method: method,
                    headers: headers
                });
                
                const result = await response.json();
                
                resultDiv.className = 'result ' + (result.code === 200 ? 'success' : 'error');
                resultDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '請求失敗：' + error.message;
            }
        }
    </script>
</body>
</html>

